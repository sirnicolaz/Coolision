<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<link rel="stylesheet" type="text/css" href="<?php echo $this->getSkinUrl('css/related.css');?>" media="all" />
<?php
    $_helper = $this->helper('catalog/output');
    $_product = $this->getProduct();
?>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
</script>
<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
<div class="product-info-box">
    <div class="product-essential">
    <form action="<?php echo $this->getAddToCartUrl($_product) ?>" method="post" id="product_addtocart_form"<?php if($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>

        <div class="product-img-box">
            <?php echo $this->getChildHtml('media') ?>
        </div>

        <div class="product-shop">
            <h3 class="product-name">
                <?php echo $_helper->productAttribute($_product, $this->htmlEscape($_product->getName()), 'name') ?>
            </h3>
			
			<div class="tabs-area">
				<div class="product-collateral">
				
				<div class="tab">
		        <?php if ($_description = $this->getChildHtml('description')):?>
		            <div class="collateral-box">
		                <div class="head">
		                    <h4><?php echo $this->__('Product Description') ?></h4>
		                </div>
		                <?php echo $_description ?>
		            </div>
		        <?php endif;?>
				</div>
				
				<!--Measures tab-->
				<div class="tab">
				<?php if ($_measures = $this->getChildHtml('measures')):?>
		            <div class="collateral-box">
		                <div class="head">
		                    <h4><?php echo $this->__('Measures') ?></h4>
		                </div>
		           <?php echo $_measures ?>
		            </div>
		        <?php endif;?>
				</div>
				
				<!-- Shipping info tab--><!-- Il contenuto di questo blocco andrebbe inserito in un file di template separato per rendere il codice un po' più pulito. Chi avesse voglia faccia pure perchè al momento non mi sovviene come fare-->
				<script>
					function changeCost(){
						var mylist=document.getElementById("shipStates")
						var val = mylist.options[mylist.selectedIndex].value;
						document.getElementById("shipCost").value=val;
					}
				</script>
				<div class="tab">
		            <div class="collateral-box">
		                <div class="head">
		                    <h4><?php echo $this->__('Shipping') ?></h4>
		                </div>
						<div><!--Da qui-->
							<span id="ship-descr">Llorem ipsum pizza pizza pie pepperoni mushrooms potatos cookies pizza salami paprika</span>
							<br/>
							<select class="ship-states" id="shipStates" onChange="changeCost()">
								<option value="13.00$">Italy</option>
								<option value="19.00$">Germany</option>
								<option value="129.00$">Wonderland</option>
							</select>
							<br/>
							<label class="ship-lab">SHIPPING COST </label><input type="text" id="shipCost" class="ship-cost" readonly="readonly" value="13.00 $" ></input>
						</div><!--A qui-->
		            </div>
				</div>
				
				</div>
			</div>
			
            <?php if ($this->canEmailToFriend()): ?>
                <a href="<?php echo $this->helper('catalog/product')->getEmailToFriendUrl($_product) ?>"><?php echo $this->__('Email to a Friend') ?></a><br />
            <?php endif; ?>

            <?php echo $this->getReviewsSummaryHtml($_product, false, true)?>

            <fieldset class="no-display">
              <input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
              <input type="hidden" name="related_product" id="related-products-field" value="" />
            </fieldset>

            <?php echo $this->getChildHtml('alert_urls') ?>
            <?php echo $this->getChildHtml('product_type_data') ?>
            <?php echo $this->getTierPriceHtml() ?>

            <?php if (!$this->hasOptions()):?>
                <div class="add-to-holder">
                    <?php if($_product->isSaleable()): ?>
                        <?php echo $this->getChildHtml('addtocart') ?>
                        <?php if( $this->helper('wishlist')->isAllow() || $_compareUrl=$this->helper('catalog/product_compare')->getAddUrl($_product)): ?>
                            <span class="add-or"><?php echo $this->__('OR') ?></span>
                        <?php endif; ?>
                    <?php endif; ?>
                    <?php echo $this->getChildHtml('addto') ?>
                </div>
            <?php else:?>
                <?php echo $this->getChildHtml('addto') ?>
            <?php endif; ?>

            <div class="divider"></div>

            <?php if ($_product->getShortDescription()):?>
                <h4><?php echo $this->__('Quick Overview') ?></h4>
                <div class="short-description"><?php echo $_helper->productAttribute($_product, nl2br($_product->getShortDescription()), 'short_description') ?></div>
            <?php endif;?>

            <?php echo $this->getChildHtml('other');?>

            <?php if ($_product->isSaleable() && $this->hasOptions()):?>
                <?php echo $this->getChildChildHtml('container1', '', true, true) ?>
            <?php endif;?>

        </div>
        <div class="clear"></div>
        <?php if ($_product->isSaleable() && $this->hasOptions()):?>
            <?php echo $this->getChildChildHtml('container2', '', true, true) ?>
        <?php endif;?>
    </form>
    <script type="text/javascript">
            var productAddToCartForm = new VarienForm('product_addtocart_form');
            productAddToCartForm.submit = function(){
					
					//Renderize radio button as dropdown to validate user selection
					
					//Isolate data for each div
					var attributes = $$('.super-attribute-select');
					var selectIds = new Array();
					var selectNames = new Array();
					var selectClasses = new Array();
					var selectedOptionId = new Array();
					var selectedOptionValue = new Array();
					
					for(var i=0; i<attributes.length; i++){
							selectNames[i]=attributes[i].getAttribute('name');
							selectClasses[i]=attributes[i].getAttribute('class');
							selectIds[i]=attributes[i].getAttribute('id');
							
							var optionId = new Array();
							var optionValue = new Array();
							for(var j=0; j<attributes[i].getElementsByTagName('input').length; j++){
								if(attributes[i].getElementsByTagName('input')[j].checked){
									optionValue=attributes[i].getElementsByTagName('input')[j].getAttribute('value');
									optionId=attributes[i].getElementsByTagName('input')[j].getAttribute('id');
								}
							}
							selectedOptionId[i] = optionId;
							selectedOptionValue[i] = optionValue;
					}
					
					//Generate select
					var selectsContainer = document.getElementById('dd-settings-container');//.getElementsByTagName('dl')[0];
					var newDD = "";
					for(var i=0; i<attributes.length; i++){
						newDD = newDD + '<select style="display:none;" name="'+selectNames[i]+'" id="'+selectIds[i]+'" class="'+selectClasses[i]+'">'+'<option selected="selected" value="' + selectedOptionValue[i] + '" id="' + selectedOptionId[i] + '" ></option>'+'</select>';
					}
					selectsContainer.innerHTML = newDD;
					//alert(selectsContainer.innerHTML);
					//TODO: verify radio is checked
                    if (this.validator.validate()) {
                            this.form.submit();
                    }
            }.bind(productAddToCartForm);
    </script>
    </div>
	
	<div class="related-product">
		<?php echo $this->getLayout()->getBlock('catalog.product.related')->toHtml(); ?>
    </div>
	
	<div class="product-collateral">
	<?php if ($_additional = $this->getChildHtml('additional')):?>
	            <div class="collateral-box">
	                <div class="head">
	                    <h4><?php echo $this->__('Additional Information') ?></h4>
	                </div>
	                <?php echo $_additional ?>
	            </div>
	        <?php endif;?>
	        <?php echo $this->getChildHtml('upsell_products') ?>
	        <?php echo $this->getChildHtml('product_additional_data') ?>
	
		
	</div>
</div>